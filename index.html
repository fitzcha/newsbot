<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fitz Intelligence v3.2</title>
    <style>
        :root { --primary: #007bff; --bg: #f4f7f6; --card: #ffffff; }
        body { font-family: 'Pretendard', sans-serif; background: var(--bg); margin: 0; padding: 20px; color: #333; }
        .container { max-width: 850px; margin: 0 auto; }
        
        /* í‚¤ì›Œë“œ íƒœê·¸ ê´€ë¦¬ ì„¹ì…˜ */
        .keyword-manager { background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 25px; }
        .tag-container { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; }
        .tag { background: #eef2f7; padding: 5px 12px; border-radius: 20px; display: flex; align-items: center; font-size: 0.9em; border: 1px solid #d1d9e6; }
        .tag .remove-btn { margin-left: 8px; cursor: pointer; color: #ff4d4f; font-weight: bold; }
        .add-keyword { margin-top: 15px; display: flex; gap: 10px; }
        .add-keyword input { flex: 1; padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px; }
        .btn-add { background: var(--primary); color: #fff; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; }

        /* ë‚ ì§œ ì„ íƒê¸° */
        .date-filter { margin-bottom: 20px; display: flex; align-items: center; gap: 10px; background: #fff; padding: 15px; border-radius: 12px; }
        .date-filter select { padding: 8px; border-radius: 6px; border: 1px solid #ddd; font-size: 1em; }

        /* ì§êµ° ì„ íƒ UI */
        .role-tabs { display: flex; justify-content: center; gap: 10px; margin-bottom: 25px; }
        .role-btn { padding: 10px 30px; border: 1px solid #ddd; background: #fff; border-radius: 30px; cursor: pointer; transition: 0.3s; }
        .role-btn.active { background: var(--primary); color: #fff; border-color: var(--primary); font-weight: bold; }

        /* ë‰´ìŠ¤ ì¹´ë“œ ë””ìì¸ */
        .news-card { background: var(--card); padding: 20px; border-radius: 12px; margin-bottom: 15px; border-left: 6px solid #ddd; }
        .news-card.active-role { border-left-color: var(--primary); }
        .card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; }
        .news-link { font-size: 0.8em; color: var(--primary); text-decoration: none; padding: 4px 10px; border: 1px solid var(--primary); border-radius: 6px; }
        .summary-box { background: #f9f9f9; padding: 12px; border-radius: 8px; font-size: 0.95em; line-height: 1.6; }
    </style>
</head>
<body>

<div class="container">
    <h1>Fitz Intelligence <small style="font-size: 0.4em; color: #888;">v3.2</small></h1>

    <section class="keyword-manager">
        <strong>ğŸ“Œ í˜„ì¬ ìˆ˜ì§‘ í‚¤ì›Œë“œ</strong>
        <div id="tag-list" class="tag-container">
            </div>
        <div class="add-keyword">
            <input type="text" id="new-keyword" placeholder="ì¶”ê°€í•  í‚¤ì›Œë“œ ì…ë ¥">
            <button class="btn-add" onclick="addKeyword()">ì¶”ê°€</button>
        </div>
        <p style="font-size: 0.8em; color: #999; margin-top: 10px;">* ì¶”ê°€/ì‚­ì œ ì‹œ êµ¬ê¸€ ì‹œíŠ¸ì™€ ë™ê¸°í™”ë©ë‹ˆë‹¤. (GAS ë¸Œë¦¿ì§€ í•„ìš”)</p>
    </section>

    <section class="date-filter">
        <strong>ğŸ“… ë¦¬í¬íŠ¸ ì¡°íšŒ:</strong>
        <select id="date-select" onchange="renderByDate()">
            </select>
    </section>

    <div class="role-tabs">
        <button id="tab-pm" class="role-btn active" onclick="setRole('PM')">PM (ê¸°íš/ë™í–¥)</button>
        <button id="tab-ba" class="role-btn" onclick="setRole('BA')">BA (ì‚¬ì—…/ìˆ˜ìµ)</button>
    </div>

    <div id="ai-briefing-box" style="margin-bottom: 20px;"></div>
    <div id="news-list"></div>
</div>

<script>
    let currentRole = 'PM';
    let fullData = [];
    let keywords = []; // ì‹¤ì œë¡œëŠ” GAS ë“±ì„ í†µí•´ ì‹œíŠ¸ì—ì„œ ê°€ì ¸ì™€ì•¼ í•¨

    // ë°ì´í„° ë¡œë“œ
    async function init() {
        try {
            const res = await fetch('data.json');
            fullData = await res.json();
            
            // ë‚ ì§œ ì„ íƒê¸° ì±„ìš°ê¸°
            const dateSelect = document.getElementById('date-select');
            dateSelect.innerHTML = fullData.map(d => `<option value="${d.date}">${d.date}</option>`).join('');
            
            // ì„ì‹œ í‚¤ì›Œë“œ ëª©ë¡ (ì‹¤ì œ êµ¬í˜„ ì‹œ ì‹œíŠ¸ ë°ì´í„° ì—°ë™)
            keywords = [...new Set(fullData[0].articles.map(a => a.keyword))];
            renderKeywords();
            renderByDate();
        } catch (e) { console.error("Data load failed", e); }
    }

    // í‚¤ì›Œë“œ íƒœê·¸ ë Œë”ë§
    function renderKeywords() {
        const list = document.getElementById('tag-list');
        list.innerHTML = keywords.map(k => `
            <div class="tag">${k} <span class="remove-btn" onclick="removeKeyword('${k}')">Ã—</span></div>
        `).join('');
    }

    function addKeyword() {
        const val = document.getElementById('new-keyword').value;
        if(val) {
            keywords.push(val);
            document.getElementById('new-keyword').value = '';
            renderKeywords();
            // TODO: GAS APIë¥¼ í˜¸ì¶œí•˜ì—¬ êµ¬ê¸€ ì‹œíŠ¸ ì—…ë°ì´íŠ¸ ë¡œì§ ì¶”ê°€
        }
    }

    function removeKeyword(word) {
        keywords = keywords.filter(k => k !== word);
        renderKeywords();
        // TODO: GAS APIë¥¼ í˜¸ì¶œí•˜ì—¬ êµ¬ê¸€ ì‹œíŠ¸ ì—…ë°ì´íŠ¸ ë¡œì§ ì¶”ê°€
    }

    function setRole(role) {
        currentRole = role;
        document.querySelectorAll('.role-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(`tab-${role.toLowerCase()}`).classList.add('active');
        renderByDate();
    }

    // ë‚ ì§œë³„ ë°ì´í„° ë Œë”ë§
    function renderByDate() {
        const selectedDate = document.getElementById('date-select').value;
        const dayData = fullData.find(d => d.date === selectedDate);
        if(!dayData) return;

        // ë¸Œë¦¬í•‘ ì¶œë ¥
        const briefContent = currentRole === 'PM' ? dayData.pm_brief : dayData.ba_brief;
        document.getElementById('ai-briefing-box').innerHTML = `
            <div style="background:#eef2f7; padding:15px; border-radius:10px; border-left:5px solid var(--primary);">
                <strong>[${selectedDate} ${currentRole} ì „ëµ ë¸Œë¦¬í•‘]</strong><br>${briefContent}
            </div>
        `;

        // ë‰´ìŠ¤ ëª©ë¡ ì¶œë ¥
        const list = document.getElementById('news-list');
        list.innerHTML = dayData.articles.map(a => `
            <div class="news-card active-role">
                <div class="card-header">
                    <span class="tag" style="border:none; background:#eee;">#${a.keyword}</span>
                    <a href="${a.url}" target="_blank" class="news-link">ì›ë¬¸ë³´ê¸° â†—</a>
                </div>
                <h4 style="margin:0 0 10px 0;">${a.title}</h4>
                <div class="summary-box">
                    <strong>[${currentRole} ë¶„ì„]</strong> ${currentRole === 'PM' ? a.pm_summary : a.ba_summary}
                </div>
            </div>
        `).join('');
    }

    init();
</script>
</body>
</html>
