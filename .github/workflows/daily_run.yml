name: Daily News Analysis & Governance Bot

on:
  schedule:
    # [Fix 1] í•œêµ­ ì‹œê°„ ì˜¤ì „ 09:30 (KST) - ì •ê° ë¶€í•˜ë¥¼ í”¼í•˜ê¸° ìœ„í•´ UTC 00:30 ì„¤ì •
    - cron: '30 0 * * *'
    # [Fix 2] í•œêµ­ ì‹œê°„ ë°¤ 23:30 (KST) - ì¸ì‚¬ê¶Œ ìë™ í™•ì • (UTC 14:30)
    - cron: '30 14 * * *'
  workflow_dispatch: # ë§ˆìŠ¤í„°ì˜ ìˆ˜ë™ ì‹¤í–‰ ë²„íŠ¼ ìœ ì§€

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3
        with:
          # ì—ì´ì „íŠ¸ê°€ ì½”ë“œë¥¼ ìˆ˜ì •í•˜ê³  Pushí•˜ê¸° ìœ„í•´ í•„ìš”í•œ ì „ì²´ íˆìŠ¤í† ë¦¬ ë¡œë“œ
          fetch-depth: 0

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Run news_bot.py
        env:
          # ì‹œìŠ¤í…œ ê°€ë™ì„ ìœ„í•œ í•µì‹¬ í™˜ê²½ ë³€ìˆ˜
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
          RESEND_API_KEY: ${{ secrets.RESEND_API_KEY }}
          # ì—ì´ì „íŠ¸ ììœ¨ ì§„í™”ë¥¼ ìœ„í•œ í† í° (Push ê¶Œí•œ)
          GITHUB_TOKEN: ${{ secrets.GH_TOKEN }} 
        run: python news_bot.py

      - name: Commit and Push changes
        run: |
          git config --global user.name "Fitz Intelligence Bot"
          git config --global user.email "bot@fitzintelligence.ai"
          
          # ì—ì´ì „íŠ¸ê°€ ìˆ˜ì •í•œ ì½”ë“œ ë° data.json ì „ì²´ ìŠ¤í…Œì´ì§•
          git add .
          
          # ë³€ê²½ì‚¬í•­ì´ ìˆì„ ë•Œë§Œ ì»¤ë°‹ ìˆ˜í–‰ (ì—ëŸ¬ ë°©ì§€)
          if ! git diff --cached --quiet; then
            git commit -m "ğŸ¤– [System Evolution] $(date +'%Y-%m-%d %H:%M') KST Update"
            git push origin main
          else
            echo "No evolutionary changes detected. Skipping push."
          fi
