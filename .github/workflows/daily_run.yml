name: Daily News Bot Run

on:
  schedule:
    - cron: '0 0 * * *' # ë§¤ì¼ ì•„ì¹¨ 9ì‹œ (KST)
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ ë²„íŠ¼

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: ambassadors/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install dependencies
        run: |
          pip install -r requirements.txt

      - name: Run news bot
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          GOOGLE_SHEETS_JSON: ${{ secrets.GOOGLE_SHEETS_JSON }}
        run: python news_bot.py

      - name: Commit and Push changes
        run: |
          git config --global user.name "actions-user"
          git config --global user.email "actions@github.com"
          git add .
          git commit -m "Update news data" || echo "No changes to commit"
          git push

      # ğŸ“¢ ì—¬ê¸°ì„œë¶€í„° ì•Œë¦¼ ë‹¨ê³„ì…ë‹ˆë‹¤. (ë“¤ì—¬ì“°ê¸° í™•ì¸ í•„ìˆ˜!)
      - name: Send Report Email
        if: always() # ì„±ê³µ/ì‹¤íŒ¨ ì—¬ë¶€ì™€ ìƒê´€ì—†ì´ ë¬´ì¡°ê±´ ì‹¤í–‰
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 465
          username: ${{ secrets.MAIL_USERNAME }}
          password: ${{ secrets.MAIL_PASSWORD }}
          subject: "ğŸš— Newsbot ë¦¬í¬íŠ¸: ${{ job.status == 'success' && 'âœ… ì‘ì—… ì„±ê³µ' || 'ğŸš¨ ì‘ì—… ì‹¤íŒ¨' }}"
          body: |
            í”¼ì¸ ë‹˜, ì˜¤ëŠ˜ Newsbot ì‘ì—… ê²°ê³¼ì…ë‹ˆë‹¤.
            
            - ìƒíƒœ: ${{ job.status }}
            
            ì‹¤íŒ¨í–ˆë‹¤ë©´ API í•œë„ ì´ˆê³¼(429 ì—ëŸ¬) ë•Œë¬¸ì¼ í™•ë¥ ì´ ë†’ìŠµë‹ˆë‹¤.
            ì„±ê³µí–ˆë‹¤ë©´ ì•„ë˜ ì£¼ì†Œì—ì„œ ë¦¬í¬íŠ¸ë¥¼ í™•ì¸í•˜ì„¸ìš”!
            ğŸ‘‰ https://newsbot-smoky.vercel.app/
          to: ${{ secrets.MAIL_USERNAME }}
          from: Newsbot Assistant
